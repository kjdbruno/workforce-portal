import{a as Z,ar as G,b7 as ee,b8 as te,r as f,m as se,q as ae,O as x,P as d,Q as p,U as u,a1 as N,a2 as D,V as s,W as v,X as C,Y as z,aJ as Y,b9 as T,a3 as c,a4 as h,Z as V,aF as oe,w as re,K as R}from"./index-BwHOlpgs.js";import{u as ne,Q as le,a as ie,h as ce}from"./employee-store-ChlHG6dr.js";import{_ as de,Q as ue}from"./_plugin-vue_export-helper-CSOi6b9n.js";import{api as S}from"./axios-DSEykjIE.js";import{T as U}from"./sweetalert-eMVWFMQi.js";function B(i){if(i===!1)return 0;if(i===!0||i===void 0)return 1;const l=parseInt(i,10);return isNaN(l)?0:l}const pe=Z({name:"close-popup",beforeMount(i,{value:l}){const n={depth:B(l),handler(m){n.depth!==0&&setTimeout(()=>{const _=ee(i);_!==void 0&&te(_,m,n.depth)})},handlerKey(m){G(m,13)===!0&&n.handler(m)}};i.__qclosepopup=n,i.addEventListener("click",n.handler),i.addEventListener("keyup",n.handlerKey)},updated(i,{value:l,oldValue:n}){l!==n&&(i.__qclosepopup.depth=B(l))},beforeUnmount(i){const l=i.__qclosepopup;i.removeEventListener("click",l.handler),i.removeEventListener("keyup",l.handlerKey),delete i.__qclosepopup}}),ve={class:"flex flex-center"},_e={class:"row items-center q-gutter-xs"},fe={class:"q-mb-md"},me={class:"text-h5 text-uppercase"},xe={class:"q-mb-md"},he={class:"text-h5 text-uppercase"},ge={class:"row q-col-gutter-md"},ye={class:"col"},be={class:"text-body1 text-uppercase"},we={class:"col"},ke={class:"text-body1 text-uppercase"},$e={class:"col"},qe={class:"text-body1 text-uppercase"},De={class:"col"},Ve={class:"text-body1 text-uppercase"},Le={class:"row q-col-gutter-xl q-mt-lg"},Pe={class:"col"},Ce={class:"text-caption text-uppercase text-grey"},ze={key:0},Se={class:"text-h6 text-uppercase"},Ue={class:"text-body1 text-uppercase text-italic"},Qe={key:1},Ee={key:0},Fe={class:"text-grey q-mb-lg"},Ke={class:"text-h6 text-uppercase"},Me={class:"text-body1 text-uppercase text-italic"},Ne=["src"],Ye={class:"text-h6 text-uppercase"},Te={class:"text-body1 text-uppercase text-italic"},Re={class:"text-caption text-uppercase text-italic"},Be={key:1},Ae=["src"],Ie={class:"text-h6 text-uppercase"},je={class:"text-body1 text-uppercase text-italic"},He={class:"text-caption text-uppercase text-italic"},Oe={class:"q-gutter-sm"},We={class:"text-center"},Je={class:"iframe-container"},Xe=["src"],Ze={__name:"LeaveTrackingPage",setup(i){ne();const l=f(!1),n=f([]),m=async t=>{l.value=!0;try{const e=await S.get(`/portal/leave/${t}`);n.value=e.data.result}catch(e){console.error("Error fetching all data:",e),U.fire({icon:"error",html:`
                <div class="text-h6 text-bold text-uppercase">Error</div>
                <div class="text-caption text-capitalize;">Unable to fetch records</div>
            `})}finally{l.value=!1}},_=f(["","","",""]),g=f(["","",""]),y=f([]),b=f([]),A=se(()=>`${_.value.join("")}-${g.value.join("")}`);function Q(t,e){R(()=>{e==="first"?t<3?y.value[t+1]?.focus():b.value[0]?.focus():t<2&&b.value[t+1]?.focus()})}function E(t,e,o){o.target.value||R(()=>{e==="last"?t>0?b.value[t-1]?.focus():y.value[3]?.focus():t>0&&y.value[t-1]?.focus()})}ae(A,t=>{t.replace("-","").length===7&&I(t)});function I(t){m(t)}const F=t=>t?ce(t).format("MMMM Do, YYYY hh:mm A"):"",j=t=>{if(!t)return"";const e=t.first_name||"",o=t.middle_name?t.middle_name.charAt(0).toUpperCase()+".":"",a=t.last_name||"",r=t.suffix?` ${t.suffix}`:"";return`${e} ${o} ${a}${r}`.trim()},H=(t,e,o="en-US")=>{if(!t)return"";const a=new Date(t),r=new Date(e||t),X=a.getFullYear()===r.getFullYear()&&a.getMonth()===r.getMonth()&&a.getDate()===r.getDate(),$=k=>k.toLocaleString(o,{month:"long"}),w=k=>k.getDate(),q=k=>k.getFullYear();return X?`${$(a)} ${w(a)}, ${q(a)}`:a.getMonth()===r.getMonth()&&a.getFullYear()===r.getFullYear()?`${$(a)} ${w(a)}-${w(r)}, ${q(a)}`:`${$(a)} ${w(a)}, ${q(a)} - ${$(r)} ${w(r)}, ${q(r)}`},O=(t,e)=>{if(!t)return 0;const o=new Date(t),a=new Date(e||t);o.setHours(0,0,0,0),a.setHours(0,0,0,0);const r=Math.round((a-o)/(1e3*60*60*24));return r>=0?r+1:0},K=t=>`https://hris-ccmi${t.signature}`,W=async t=>{l.value=!0;const e=t?.id,o=n.value?.id;try{const a=await S.post(`/portal/leave/${o}/${e}/approve`);U.fire({icon:"success",html:`
                <div class="text-h6 text-bold text-uppercase">granted!</div>
                <div class="text-caption text-capitalize;">${a.data.message}<div>
            `})}catch(a){a.response&&a.response.data&&(applyBackendErrors(a.response.data),U.fire({icon:"error",html:`
                    <div class="text-h6 text-bold text-uppercase">Request Failed</div>
                    <div class="text-caption">Something went wrong.</div>
                `}))}finally{M(),l.value=!1}},M=()=>{n.value=[],_.value=["","","",""],g.value=["","",""],y.value=[],b.value=[]},L=f(!1),P=f(null),J=async t=>{l.value=!0;try{const e=await S.get(`/portal/leave/${t}/pdf`,{responseType:"arraybuffer"}),o=new Blob([e.data],{type:"application/pdf"}),a=window.URL.createObjectURL(o)+"#view=FitW";P.value=a,L.value=!0}catch(e){console.error("Error generating PDF:",e)}finally{l.value=!1}};return(t,e)=>(d(),x(ue,{class:"flex flex-center"},{default:p(()=>[u(N,{class:"radius-md no-shadow q-pa-lg",style:{width:"65%","box-shadow":"rgba(0, 0, 0, 0.09) 0px 3px 12px"}},{default:p(()=>[u(D,{class:"text-center"},{default:p(()=>e[3]||(e[3]=[s("div",{class:"text-h6 text-uppercase"},"track my leave",-1)])),_:1,__:[3]}),n.value.length===0?(d(),x(D,{key:0},{default:p(()=>[s("div",ve,[s("div",_e,[(d(!0),v(C,null,z(_.value,(o,a)=>(d(),x(Y,{key:"f"+a,modelValue:_.value[a],"onUpdate:modelValue":[r=>_.value[a]=r,r=>Q(a,"first")],maxlength:"1",outlined:"",class:"char-input",onKeydown:T(r=>E(a,"first",r),["backspace"]),ref_for:!0,ref_key:"firstRefs",ref:y,"input-style":{textAlign:"center",fontSize:"2em"}},null,8,["modelValue","onUpdate:modelValue","onKeydown"]))),128)),(d(!0),v(C,null,z(g.value,(o,a)=>(d(),x(Y,{key:"l"+a,modelValue:g.value[a],"onUpdate:modelValue":[r=>g.value[a]=r,r=>Q(a,"last")],maxlength:"1",outlined:"",class:"char-input",onKeydown:T(r=>E(a,"last",r),["backspace"]),ref_for:!0,ref_key:"lastRefs",ref:b,"input-style":{textAlign:"center",fontSize:"2em"}},null,8,["modelValue","onUpdate:modelValue","onKeydown"]))),128))])])]),_:1})):(d(),x(D,{key:1,class:"text-center"},{default:p(()=>[s("div",fe,[e[4]||(e[4]=s("div",{class:"text-caption text-uppercase text-grey"},"control no.",-1)),s("div",me,c(n.value?.control_no),1)]),s("div",xe,[e[5]||(e[5]=s("div",{class:"text-caption text-uppercase text-grey"},"employee",-1)),s("div",he,c(j(n.value?.employee)),1)]),s("div",ge,[s("div",ye,[e[6]||(e[6]=s("div",{class:"text-caption text-uppercase text-grey"},"leave type",-1)),s("div",be,c(n.value?.leaveType?.name),1)]),s("div",we,[e[7]||(e[7]=s("div",{class:"text-caption text-uppercase text-grey"},"status",-1)),s("div",ke,c(n.value?.status),1)]),s("div",$e,[e[8]||(e[8]=s("div",{class:"text-caption text-uppercase text-grey"},"leave duration",-1)),s("div",qe,c(H(n.value?.date_from,n.value?.date_to)),1)]),s("div",De,[e[9]||(e[9]=s("div",{class:"text-caption text-uppercase text-grey"},"no of day",-1)),s("div",Ve,c(O(n.value?.date_from,n.value?.date_to)),1)])]),s("div",Le,[(d(!0),v(C,null,z(n.value?.approvals,(o,a)=>(d(),v("div",Pe,[s("div",Ce,c(o?.status=="Pending"?"unsigned":o?.setting?.description),1),o?.status=="Pending"?(d(),v("div",ze,[s("div",Se,c(o?.original_approver_name),1),s("div",Ue,c(o?.original_approver_position),1),o?.order===1?(d(),x(V,{key:0,unelevated:"",size:"md",color:"primary",class:"btn-md text-capitalize q-mt-md",label:"approve",onClick:r=>W(o)},null,8,["onClick"])):h("",!0)])):h("",!0),o?.status=="Approved"?(d(),v("div",Qe,[o?.is_overide?(d(),v("div",Ee,[s("div",Fe,[s("div",Ke,c(o?.original_approver_name),1),s("div",Me,c(o?.original_approver_position),1)]),e[10]||(e[10]=s("div",{class:"text-caption text-uppercase text-italic text-bold q-mb-lg"},"overiden by",-1)),s("img",{src:K(o?.override_signature),width:"100"},null,8,Ne),s("div",Ye,c(o?.override_name),1),s("div",Te,c(o?.override_position),1),s("div",Re,c(F(o?.signed_at)),1)])):h("",!0),o?.is_overide?h("",!0):(d(),v("div",Be,[s("img",{src:K(o?.original_signature),width:"100"},null,8,Ae),s("div",Ie,c(o?.original_approver_name),1),s("div",je,c(o?.original_approver_position),1),s("div",He,c(F(o?.signed_at)),1)]))])):h("",!0)]))),256))]),s("div",Oe,[u(V,{unelevated:"",size:"md",color:"primary",class:"btn-md text-capitalize q-mt-md",label:"print",onClick:e[0]||(e[0]=o=>J(n.value?.id))}),u(V,{unelevated:"",size:"md",color:"primary",class:"btn-md text-capitalize q-mt-md",outline:"",label:"clear",onClick:e[1]||(e[1]=o=>M())})])]),_:1})),u(le,{showing:l.value},{default:p(()=>[s("div",We,[u(ie,{size:"xl",color:"primary"}),e[11]||(e[11]=s("div",{class:"text-h6 text-dark text-uppercase q-mt-xs"},"we're working on it!",-1))])]),_:1},8,["showing"])]),_:1}),u(oe,{modelValue:L.value,"onUpdate:modelValue":e[2]||(e[2]=o=>L.value=o),"full-height":"","full-width":"",class:"pdf"},{default:p(()=>[u(N,{class:"bg-white q-pa-none",style:{height:"100vh",overflow:"hidden"}},{default:p(()=>[re(u(V,{icon:"close",class:"fixed bg-white text-primary shadow-2",round:"",dense:"",style:{top:"15px",right:"15px","z-index":"999"}},null,512),[[pe]]),u(D,{class:"q-pa-none",style:{height:"100%",overflow:"hidden"}},{default:p(()=>[s("div",Je,[P.value?(d(),v("iframe",{key:0,src:P.value,frameborder:"0"},null,8,Xe)):h("",!0)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},ot=de(Ze,[["__scopeId","data-v-aba9b05c"]]);export{ot as default};
